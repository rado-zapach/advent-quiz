<h2 mat-dialog-title>Day {{ question().day }}</h2>
<mat-dialog-content class="mat-typography">
    @switch (question().state) {
        @case (State.BEFORE) {
            <span>Opens in {{ timeRemaining$ | async }}</span>
        }
        @case (State.OPEN) {
            <div class="whitespace-pre-wrap" [innerHTML]="question().text | sanitizer"></div>
            <div class="flex flex-col">
                <h2>Answer:</h2>
                <mat-form-field>
                    <textarea
                        #answerTextArea
                        [value]="answer()?.text ?? ''"
                        matInput
                        [cdkTextareaAutosize]="true"
                        [disabled]="isAnswerSavingOrLoading"
                    ></textarea>
                </mat-form-field>
                <button
                    mat-raised-button
                    color="primary"
                    (click)="onSubmitAnswer(answerTextArea.value)"
                    [disabled]="isAnswerSavingOrLoading"
                >
                    Submit
                </button>
                @if (isAnswerSavingOrLoading) {
                    <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
                }
                <div class="mt-2">Closes in {{ timeRemaining$ | async }}</div>
            </div>
        }
        @case (State.CLOSED) {
            <div class="whitespace-pre-wrap" [innerHTML]="question().text | sanitizer"></div>

            <div class="flex flex-col">
                <mat-form-field>
                    <textarea
                        [value]="answer()?.text ?? ''"
                        matInput
                        [cdkTextareaAutosize]="true"
                        disabled
                    ></textarea>
                </mat-form-field>
            </div>

            <mat-list>
                <mat-list-item>
                    <mat-icon matListItemIcon>task_alt</mat-icon>
                    <div matListItemTitle>Correct answer</div>
                    <div
                        matListItemLine
                        class="whitespace-pre-wrap"
                        [innerHTML]="question().correctAnswer | sanitizer"
                    ></div>
                </mat-list-item>
                <mat-list-item>
                    <mat-icon matListItemIcon>military_tech</mat-icon>
                    <div matListItemTitle>Your points</div>
                    {{ answer()?.points }}
                </mat-list-item>
            </mat-list>
        }
    }
</mat-dialog-content>
<mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
</mat-dialog-actions>
